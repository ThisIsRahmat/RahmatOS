---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Rahmat Junaid">
	<div class="min-h-screen flex items-center justify-center py-12 md:py-16">
		<div class="max-w-2xl">
			<!-- Name -->
			<h1 class="text-2xl font-normal text-gray-900 mb-8">Rahmat Junaid</h1>

			<!-- Main Content -->
			<div class="space-y-6 text-gray-700 leading-relaxed">
				<p>
					I'm a developer and AI engineer. I work on voice agents and conversational AI. Previously, I worked at Capgemini and Fly.io. I've been coding for 15 years and teaching for the second half.
				</p>

				<p>
					My life's work is to make technology easy to understand and interesting to learn about. I'm a husband, father, and a massive reading enthusiast. I last read <span id="last-book-title">loading...</span> by <span id="last-book-author">loading...</span>.
				</p>

				<p class="mt-8">
					Some of my favorite essays include:
				</p>

				<ul class="list-none space-y-2 mt-4">
					<li><a href="/blog" class="text-blue-600 hover:text-blue-700 underline">Things I Believe</a></li>
					<li><a href="/blog" class="text-blue-600 hover:text-blue-700 underline">Developer Experience</a></li>
					<li><a href="/blog" class="text-blue-600 hover:text-blue-700 underline">AI Voice Agents</a></li>
					<li><a href="/blog" class="text-blue-600 hover:text-blue-700 underline">Developer Products</a></li>
					<li><a href="/blog" class="text-blue-600 hover:text-blue-700 underline">Teaching and Learning</a></li>
				</ul>

				<p class="mt-8">
					You can read my <a href="/blog" class="text-blue-600 hover:text-blue-700 underline">writing</a> or <a href="/projects" class="text-blue-600 hover:text-blue-700 underline">code</a>, or follow me <a href="https://twitter.com/rahmatjunaid" class="text-blue-600 hover:text-blue-700 underline">online</a>. I also <a href="/projects" class="text-blue-600 hover:text-blue-700 underline">make videos</a>, advise companies, and do angel investing. Reach out if interested.
				</p>
			</div>
		</div>
	</div>

	<script>
		const CACHE_KEY = 'literal-currently-reading';
		const CACHE_DURATION = 10 * 60 * 1000; // 10 minutes

		async function loadLastBook() {
			const titleElement = document.getElementById('last-book-title');
			const authorElement = document.getElementById('last-book-author');

			if (!titleElement || !authorElement) return;

			try {
				// Try to load from localStorage first
				const cached = localStorage.getItem(CACHE_KEY);
				if (cached) {
					const { data, timestamp } = JSON.parse(cached);
					const age = Date.now() - timestamp;

					if (age < CACHE_DURATION && data.length > 0) {
						const book = data[0].book;
						titleElement.textContent = book.title;
						authorElement.textContent = book.authors.map((author: any) => author.name).join(', ');
						return;
					}
				}

				// Fetch fresh data
				const response = await fetch('/api/books?type=currently-reading');
				if (!response.ok) {
					throw new Error('Failed to fetch books');
				}

				let responseData = await response.json();

				// Handle both array and object response formats
				const currentlyReading = Array.isArray(responseData)
					? responseData
					: (responseData.currentlyReading || []);

				// Cache the data
				localStorage.setItem(CACHE_KEY, JSON.stringify({
					data: currentlyReading,
					timestamp: Date.now()
				}));

				if (currentlyReading.length > 0) {
					const book = currentlyReading[0].book;
					titleElement.textContent = book.title;
					authorElement.textContent = book.authors.map((author: any) => author.name).join(', ');
				} else {
					titleElement.textContent = 'No book currently';
					authorElement.textContent = '';
				}
			} catch (error) {
				console.error('Error loading books:', error);

				// Try to use stale cache as fallback
				const cached = localStorage.getItem(CACHE_KEY);
				if (cached) {
					const { data } = JSON.parse(cached);
					if (data.length > 0) {
						const book = data[0].book;
						titleElement.textContent = book.title;
						authorElement.textContent = book.authors.map((author: any) => author.name).join(', ');
					}
				} else {
					titleElement.textContent = 'unavailable';
					authorElement.textContent = '';
				}
			}
		}

		// Load books when page is ready
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', loadLastBook);
		} else {
			loadLastBook();
		}
	</script>
</Layout>
